{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Memora AI platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "googleId": {
          "type": "string",
          "description": "User's Google ID for authentication."
        },
        "callName": {
          "type": "string",
          "description": "User's preferred call name."
        },
        "surname": {
          "type": "string",
          "description": "User's surname."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "creditBalance": {
          "type": "number",
          "description": "User's current credit balance."
        },
        "onboardingCompleted": {
            "type": "boolean",
            "description": "Whether the user has completed the onboarding flow."
        }
      },
      "required": [
        "id",
        "googleId",
        "callName",
        "surname"
      ]
    },
    "Space": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Space",
      "type": "object",
      "description": "Represents a space or isolated information room within Memora AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the space."
        },
        "spaceTypeId": {
          "type": "string",
          "description": "Reference to SpaceType. (Relationship: Space 1:1 SpaceType)"
        },
        "name": {
          "type": "string",
          "description": "Name of the space."
        },
        "description": {
          "type": "string",
          "description": "Description of the space."
        },
        "creationDate": {
          "type": "string",
          "description": "Date the space was created.",
          "format": "date-time"
        },
        "creatorId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Space, Creator)",
          "format": "uuid"
        },
        "inviteCode": {
          "type": "string",
          "description": "Unique 5-digit code for inviting users to the space."
        }
      },
      "required": [
        "id",
        "spaceTypeId",
        "name",
        "description",
        "creationDate",
        "creatorId",
        "inviteCode"
      ]
    },
    "SpaceType": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SpaceType",
      "type": "object",
      "description": "Represents the type of space, e.g., 'College'.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the space type."
        },
        "name": {
          "type": "string",
          "description": "Name of the space type (e.g., College)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "SpaceMembership": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SpaceMembership",
      "type": "object",
      "description": "Represents the membership of a user in a space.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the space membership."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N SpaceMembership)"
        },
        "spaceId": {
          "type": "string",
          "description": "Reference to Space. (Relationship: Space 1:N SpaceMembership)"
        },
        "joinDate": {
          "type": "string",
          "description": "Date the user joined the space.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "spaceId",
        "joinDate"
      ]
    },
    "Summary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Summary",
      "type": "object",
      "description": "Represents a summary generated by the AI for a specific topic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the summary."
        },
        "spaceId": {
          "type": "string",
          "description": "Reference to Space. (Relationship: Space 1:N Summary)"
        },
        "topic": {
          "type": "string",
          "description": "Topic of the summary."
        },
        "content": {
          "type": "string",
          "description": "The summarized content."
        },
        "lastUpdated": {
          "type": "string",
          "description": "Date the summary was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "spaceId",
        "topic",
        "content",
        "lastUpdated"
      ]
    },
    "InformationSource": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InformationSource",
      "type": "object",
      "description": "Represents a source of information used to generate a summary.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the information source."
        },
        "spaceId": {
          "type": "string",
          "description": "Reference to Space. (Relationship: Space 1:N InformationSource)"
        },
        "summaryId": {
          "type": "string",
          "description": "Reference to Summary. (Relationship: Summary 1:N InformationSource)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N InformationSource)"
        },
        "sourceType": {
          "type": "string",
          "description": "Type of information source (e.g., manual entry, chat reply)."
        },
        "content": {
          "type": "string",
          "description": "Raw content from the information source."
        },
        "dateAdded": {
          "type": "string",
          "description": "Date the information was added.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "spaceId",
        "summaryId",
        "userId",
        "sourceType",
        "content",
        "dateAdded"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a chat message between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ChatMessage, Sender)"
        },
        "receiverId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N ChatMessage, Receiver)"
        },
        "spaceId": {
          "type": "string",
          "description": "Reference to Space. (Relationship: Space 1:N ChatMessage)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of the message.",
          "format": "date-time"
        },
        "content": {
          "type": "string",
          "description": "Content of the message."
        },
        "remembered": {
          "type": "boolean",
          "description": "Indicates if the message should be used for AI knowledge."
        }
      },
      "required": [
        "id",
        "senderId",
        "receiverId",
        "spaceId",
        "timestamp",
        "content",
        "remembered"
      ]
    },
    "ClubMembership": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ClubMembership",
      "type": "object",
      "description": "Represents a user's membership in a club within a space.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the club membership."
        },
        "spaceMembershipId": {
          "type": "string",
          "description": "Reference to SpaceMembership. (Relationship: SpaceMembership 1:N ClubMembership)"
        },
        "clubName": {
          "type": "string",
          "description": "Name of the club."
        },
        "position": {
          "type": "string",
          "description": "User's position in the club."
        }
      },
      "required": [
        "id",
        "spaceMembershipId",
        "clubName",
        "position"
      ]
    },
    "WorkExperience": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkExperience",
      "type": "object",
      "description": "Represents a user's work experience within a space.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the work experience."
        },
        "spaceMembershipId": {
          "type": "string",
          "description": "Reference to SpaceMembership. (Relationship: SpaceMembership 1:N WorkExperience)"
        },
        "organizationName": {
          "type": "string",
          "description": "Name of the organization."
        },
        "employmentType": {
          "type": "string",
          "description": "Type of employment (e.g., intern, full-time)."
        },
        "position": {
          "type": "string",
          "description": "User's position at the organization."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of employment (DDMMYYYY format).",
          "format": "date"
        },
        "endDate": {
          "type": "string",
          "description": "End date of employment (DDMMYYYY format).",
          "format": "date"
        }
      },
      "required": [
        "id",
        "spaceMembershipId",
        "organizationName",
        "employmentType",
        "position",
        "startDate",
        "endDate"
      ]
    },
    "CollegeSpaceDetails": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CollegeSpaceDetails",
      "type": "object",
      "description": "Specific details for users in a college space.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the college space details."
        },
        "spaceMembershipId": {
          "type": "string",
          "description": "Reference to SpaceMembership. (Relationship: SpaceMembership 1:1 CollegeSpaceDetails)"
        },
        "year": {
          "type": "string",
          "description": "Year of study."
        },
        "department": {
          "type": "string",
          "description": "Department of study."
        }
      },
      "required": [
        "id",
        "spaceMembershipId",
        "year",
        "department"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership: only the user can read/write their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/space_types/{spaceTypeId}",
        "definition": {
          "entityName": "SpaceType",
          "schema": {
            "$ref": "#/backend/entities/SpaceType"
          },
          "description": "Stores the different types of spaces (e.g., college).",
          "params": [
            {
              "name": "spaceTypeId",
              "description": "The unique ID of the space type."
            }
          ]
        }
      },
      {
        "path": "/spaces/{spaceId}",
        "definition": {
          "entityName": "Space",
          "schema": {
            "$ref": "#/backend/entities/Space"
          },
          "description": "Stores space information. Includes 'creatorId' for authorization independence.",
          "params": [
            {
              "name": "spaceId",
              "description": "The unique ID of the space."
            }
          ]
        }
      },
      {
        "path": "/space_memberships/{spaceMembershipId}",
        "definition": {
          "entityName": "SpaceMembership",
          "schema": {
            "$ref": "#/backend/entities/SpaceMembership"
          },
          "description": "Represents the membership of a user in a space. Includes 'userId' and 'spaceId' for authorization independence.",
          "params": [
            {
              "name": "spaceMembershipId",
              "description": "The unique ID of the space membership."
            }
          ]
        }
      },
      {
        "path": "/spaces/{spaceId}/summaries/{summaryId}",
        "definition": {
          "entityName": "Summary",
          "schema": {
            "$ref": "#/backend/entities/Summary"
          },
          "description": "Stores summaries for a specific space. Includes 'spaceId' for authorization independence.",
          "params": [
            {
              "name": "spaceId",
              "description": "The unique ID of the space."
            },
            {
              "name": "summaryId",
              "description": "The unique ID of the summary."
            }
          ]
        }
      },
      {
        "path": "/spaces/{spaceId}/summaries/{summaryId}/information_sources/{informationSourceId}",
        "definition": {
          "entityName": "InformationSource",
          "schema": {
            "$ref": "#/backend/entities/InformationSource"
          },
          "description": "Stores information sources for a specific summary. Includes 'spaceId' and 'summaryId' for authorization independence.",
          "params": [
            {
              "name": "spaceId",
              "description": "The unique ID of the space."
            },
            {
              "name": "summaryId",
              "description": "The unique ID of the summary."
            },
            {
              "name": "informationSourceId",
              "description": "The unique ID of the information source."
            }
          ]
        }
      },
      {
        "path": "/spaces/{spaceId}/chat_messages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages within a space. Includes 'senderId', 'receiverId', and 'spaceId' for authorization independence.",
          "params": [
            {
              "name": "spaceId",
              "description": "The unique ID of the space."
            },
            {
              "name": "chatMessageId",
              "description": "The unique ID of the chat message."
            }
          ]
        }
      },
      {
        "path": "/space_memberships/{spaceMembershipId}/club_memberships/{clubMembershipId}",
        "definition": {
          "entityName": "ClubMembership",
          "schema": {
            "$ref": "#/backend/entities/ClubMembership"
          },
          "description": "Stores club memberships for a user within a space. Includes 'spaceMembershipId' for authorization independence.",
          "params": [
            {
              "name": "spaceMembershipId",
              "description": "The unique ID of the space membership."
            },
            {
              "name": "clubMembershipId",
              "description": "The unique ID of the club membership."
            }
          ]
        }
      },
      {
        "path": "/space_memberships/{spaceMembershipId}/work_experiences/{workExperienceId}",
        "definition": {
          "entityName": "WorkExperience",
          "schema": {
            "$ref": "#/backend/entities/WorkExperience"
          },
          "description": "Stores work experiences for a user within a space. Includes 'spaceMembershipId' for authorization independence.",
          "params": [
            {
              "name": "spaceMembershipId",
              "description": "The unique ID of the space membership."
            },
            {
              "name": "workExperienceId",
              "description": "The unique ID of the work experience."
            }
          ]
        }
      },
      {
        "path": "/space_memberships/{spaceMembershipId}/college_space_details/{collegeSpaceDetailsId}",
        "definition": {
          "entityName": "CollegeSpaceDetails",
          "schema": {
            "$ref": "#/backend/entities/CollegeSpaceDetails"
          },
          "description": "Stores college-specific details for a user within a space. Includes 'spaceMembershipId' for authorization independence.",
          "params": [
            {
              "name": "spaceMembershipId",
              "description": "The unique ID of the space membership."
            },
            {
              "name": "collegeSpaceDetailsId",
              "description": "The unique ID of the college space details."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the Memora AI platform. Key strategies include denormalization and structural segregation to simplify security rules and support atomic operations.\n\nAuthorization Independence (CRITICAL): Authorization independence is achieved through denormalization. For instance, `SpaceMembership` documents include `userId` and `spaceId`, allowing rules to verify membership without needing to `get()` data from `/users` or `/spaces`. Similarly, `ChatMessage` includes `senderId`, `receiverId`, and `spaceId`, eliminating the need to traverse up the hierarchy for authorization.\n\nQAPs (Rules are not Filters): The structure supports secure list operations through structural segregation. User-specific data (e.g., user profiles) is stored under `/users/{userId}`, ensuring that only the user can access their data. Collaborative data (e.g., spaces, chat messages) utilizes membership maps where appropriate and denormalization of space details, allowing efficient and secure querying of space-related data.\n\nHomogeneous Security Posture: Each collection is designed to contain documents with the same security requirements. For example, all documents in `/spaces/{spaceId}/chatMessages` have the same read/write permissions based on space membership.\n\nAccess Modeling: Path-based ownership is used for user-specific data, such as `/users/{userId}`. Collaborative data relies on the membership map pattern, with membership information stored directly within `SpaceMembership` documents. Global roles are not explicitly implemented, as the system relies on user-space relationships for authorization."
  }
}
